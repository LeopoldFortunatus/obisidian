{
  "user_id": "",
  "service": "userserver",
  "key_type": "access",
  "exp": 1789863766,
  "iss": "auth.service",
  "sub": "gateway"
}

это токен который создается динамически для аутентификация гейтвея в сервисах типа ipam,user и т.п. 

Сейчас схема такая:
1 пользовательский токен прилетает в гейтвей
2 гейтвей использует свой токен для аутентификации на одном из сервисов
3 сервис посылает запрос в нейтив со вшитым  токеном

а нам надо чтобы:
1 пользователь послал свой токен в гейтве
2 гейт передал токен в сервис
3 сервис авторизовал токен в spicedb и переслал токен дальше в нейтив
при выполнении саги в шаге 3 сервис берет пользовательский токен регистрирует сагу в spicedb и со своим токеном выполняет запрос

сейчас приходит токен пользователя, проходит авторизация в гейте, а в другие сервисы гейт ходит со сгенеренным заранее токеном из конфига (для нейтива с логином и паролем)

но там правда ещё надо будет выдавать сервисам пользовательские привилегии для выполнения саг, мы это сделали в своей песочнице но в реальности пока не тестили

для тестирования можно удалить interceptorAuth.UnarySimple(logger), из serverInterceptors в сервисе, например, для user-service: cmd/user-service/main.go:205
тогда должно рабтать с нашим токеном везде, по идее


Разбирался с ошибкой при обмене токена из гейтвея, в итоге разобрался, описал в треде про auth.service. Сивцов сейчас чинит, но пока что-то не деплоится.